!function(o){o.videoPlayer=function(e,n){var t={cover:".cover",coverImage:"img",volume:.5,controls:".controls",bar:".controls__bar-wrapper",buttons:".controls__overlay",controlPlay:".controls__play",controlRewind:".controls__rewind",controlFullScreen:".controls__fs",controlTime:".controls__time",controlDuration:".controls__duration",controlProgressBar:".controls__progress",controlProgress:".controls__progress-time",controlVolumeBar:".controls__volume-bar",controlVolume:".controls__volume-bar__amount",controlVolumeIcon:".controls__volume-icon",overlays:".overlay",restartOnPause:!1,playOnViewport:!1,stopOffViewport:!1,endAtLastFrame:!1},l=this;l.opts={};var r=o(document),u=o(e),s=u.find("> video"),i=s.get(0),a=null,c=null,p=null,m=null,d=null,f=null,v=null,y=null,g=null,w=null,_=null,h=null,P=null,V=null,b=null,T=null,C=null,F=null,k=(s.attr("src"),s.is("[autoplay]")),R=!1,q=!1,B=!1,I=!1,O=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;l.init=function(){l.opts=o.extend({},t,n),l._construct()},l._construct=function(){c=u.find(l.opts.cover),m=u.find(l.opts.controls),d=u.find(l.opts.bar),f=u.find(l.opts.buttons),y=m.find(l.opts.controlRewind),v=m.find(l.opts.controlPlay),g=m.find(l.opts.controlFullScreen),w=m.find(l.opts.controlDuration),$controlTime=m.find(l.opts.controlTime),h=m.find(l.opts.controlProgress),_=m.find(l.opts.controlProgressBar),V=m.find(l.opts.controlVolume),P=m.find(l.opts.controlVolumeBar),b=m.find(l.opts.controlVolumeIcon),F=l.opts.volume,p=c.find(l.opts.coverImage),a=c.get(0),m.length&&(C=v.get(0),y.length&&(T=y.get(0))),i.load(),l.events(),l.initViewportPlay(),l.initProgressBar(),l.initVolumeBar()},l.events=function(){v.length&&v.on("click",l.maybePlay),c.length&&c.on("click",l.maybePlay),y.length&&y.on("click",l.maybeRewind),g.length&&g.on("click",function(o){o.preventDefault(),l.fullscreen()}),s.on("loadedmetadata",l.initVideo),s.on("timeupdate",l.updateTime),s.on("canplaythrough",function(){I=!0}),s.on("ended",function(){l.stop(!1)}),O&&s.on("webkitExitFullscreen",l.stop)},l.initVideo=function(){l.updateVolume(0,l.opts.volume),l.updateDuration(),k&&l.maybePlay()},l.initProgressBar=function(){_.length&&(_.on("mousedown",function(o){R=!0,l.updateProgress(o.pageX)}),r.on("mouseup",function(o){R&&(R=!1,l.updateProgress(o.pageX))}),r.on("mousemove",function(o){R&&l.updateProgress(o.pageX)}))},l.initVolumeBar=function(){b.length&&b.click(function(o){if(o.preventDefault(),0==i.volume)0==F&&(F=l.opts.volume),l.updateVolume(0,F);else{var e=i.volume;l.updateVolume(0,0),F=e}}),P.length&&(P.on("mousedown",function(o){q=!0,i.muted=!1,l.updateVolumeIcon(1),l.updateVolume(o.pageX)}),r.on("mouseup",function(o){q&&(q=!1,l.updateVolume(o.pageX))}),r.on("mousemove",function(o){q&&l.updateVolume(o.pageX)}))},l.initViewportPlay=function(){u._appear({force_process:!0}),l.opts.playOnViewport&&(u.on("_appear",function(){B||l.play()}),l.opts.stopOffViewport&&u.on("_disappear",function(){B&&l.stop(!0)}))},l.play=function(){v.removeClass("nicon-play").addClass("nicon-pause"),TweenMax.to(l.opts.overlays,.2,{opacity:0,onComplete:function(){}}),i.play(),l.afterPlay()},l.afterPlay=function(){u.removeClass("paused").addClass("playing"),B=!0},l.stop=function(o){u.removeClass("playing"),v.removeClass("nicon-pause").addClass("nicon-play"),o?(l.opts.restartOnPause||p.hide(),u.addClass("paused"),TweenMax.to(l.opts.overlays,.2,{opacity:1,onComplete:function(){setTimeout(function(){},300)}}),i.pause(),l.opts.restartOnPause&&(i.currentTime=0),B=!1):(p.show(),TweenMax.to(l.opts.overlays,.2,{opacity:1,onComplete:function(){}}),l.opts.endAtLastFrame||(i.currentTime=0,i.load()),B=!1)},l.maybeRewind=function(){i.currentTime=0,l.play()},l.maybePlay=function(){return B?l.stop(!0):l.play(),!1},l.fullscreen=function(){i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.webkitEnterFullscreen?i.webkitEnterFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.msRequestFullscreen?i.msRequestFullscreen():alert("Your browser doesn't support fullscreen")},l.updateTime=function(){var o=i.currentTime,e=i.duration,n=100*o/e;h&&h.css("width",n+"%"),$controlTime.length&&$controlTime.html(l.formatTime(o))},l.updateDuration=function(){var o=i.duration;w.length&&w.html(l.formatTime(o))},l.updateProgress=function(o){var e=i.duration,n=o-_.offset().left,t=100*n/_.width();t>100?t=100:t<0&&(t=0),h.css("width",t+"%"),i.currentTime=e*t/100},l.updateVolume=function(o,e){var n;if(e)n=100*e;else var t=o-P.offset().left,n=100*t/P.width();n>100?n=100:n<0&&(n=0),i.volume=n/100,l.updateVolumeIcon(i.volume),V.css("width",n+"%"),e=i.volume},l.updateVolumeIcon=function(o){0==o?b.addClass("nicon-volume-off").removeClass("nicon-volume"):b.addClass("nicon-volume").removeClass("nicon-volume-off")},l.formatTime=function(o){return minutes=Math.floor(o/60),minutes=minutes>=10?minutes:"0"+minutes,o=Math.floor(o%60),o=o>=10?o:"0"+o,minutes+":"+o},l.init()},o.fn.videoPlayer=function(e){return this.each(function(){if(void 0==o(this).data("videoPlayer")){var n=new o.videoPlayer(this,e);o(this).data("videoPlayer",n)}})}}(jQuery);